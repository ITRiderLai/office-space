# 权属申请页分析

## 页面概述

权属申请是"业务申请"模块下的子功能，用于提交办公用房权属相关的申请。

---

## 更新记录

### 2026-01-22 设计稿更新

根据最新设计稿，与当前实现对比，主要变化如下：

| 区域 | 当前实现 | 新设计稿 | 是否需要修改 |
|------|----------|----------|--------------|
| 顶部操作栏 | 无 | 新增"保存"、"关闭"按钮 | ✅ 需新增 |
| 左侧导航样式 | 绿色高亮 (#5fb878) | 蓝色高亮 (#1890ff) + 左侧竖条 | ✅ 需修改 |
| 左侧导航项 | 仅"申请信息" | "申请信息"、"其他目录"、"其他目录" | ✅ 需扩展 |
| 表单首行布局 | 单列 | 两列（业务类型 + 办理日期同行） | ✅ 需修改 |
| 申请单位/关联楼宇 | 搜索图标触发选择 | "选择"+"清除"两个按钮 | ✅ 需修改 |
| 文件上传样式 | 默认上传组件 | 按钮样式 + "(上传文件格式为pdf)"提示 | ✅ 需修改 |
| 来文附件列表 | 无 | 新增表格展示已上传文件 | ✅ 需新增 |
| 表单底部保存按钮 | 有 | 移至顶部操作栏 | ✅ 需移除 |

---

## 页面结构

```
┌─────────────────────────────────────────────────────────────────────┐
│  办公用房管理系统                              全屏    👤 张小凡    │  ← 复用现有
├──────────┬──────────────────────────────────────────────────────────┤
│          │  ◀◀  首页   权属申请 ✕   单位卡片 ✕   出借台账 ✕    ▶▶  │  ← 复用现有
│  侧边栏   ├──────────────────────────────────────────────────────────┤
│ (复用现有)│  [保存]  [关闭]                                          │  ← 【新开发】操作栏
│          ├──────────────────────────────────────────────────────────┤
│          │  业务类型：xxx  业务编号：xxx  受理人员：xxx  当前环节：xxx │  ← 【新开发】
│          ├──────┬───────────────────────────────────────────────────┤
│          │      │                                                   │
│          │ 步骤  │              表单区域                             │  ← 【新开发】
│          │ 导航  │  ┌─────────────────┬─────────────────┐           │
│          │      │  │ 业务类型        │ *办理日期       │           │
│          │      │  ├─────────────────┴─────────────────┤           │
│          │      │  │ *来文标题                         │           │
│          │      │  │ *来文文号                         │           │
│          │      │  │ *申请单位      [选择] [清除]      │           │
│          │      │  │ 关联楼宇       [选择] [清除]      │           │
│          │      │  │ ...                               │           │
│          │      │                                                   │
└──────────┴──────┴───────────────────────────────────────────────────┘
```

---

## 复用现有组件

以下部分直接使用 layui-vue-admin 模板现有功能：

| 组件 | 说明 |
|------|------|
| 顶部导航栏 | 系统名称、全屏、用户信息 |
| 左侧菜单栏 | 菜单结构需在 `src/mockjs/user.ts` 配置 |
| 标签页区域 | 多标签切换、工具栏 |

### 菜单配置（需添加到 user.ts）
```typescript
{
  id: '/business',
  icon: 'layui-icon-form',
  title: '业务申请',
  children: [
    { id: '/business/ownership', icon: 'layui-icon-form', title: '权属申请' },
  ]
}
```

---

## 【新开发】一、业务信息栏

横向展示当前业务基本信息：

| 字段 | 示例值 |
|------|--------|
| 业务类型 | 办公用房-权属申请 |
| 业务编号 | 2026011400001 |
| 受理人员 | 曾启松 |
| 当前环节 | 申请 |

**样式**：灰色背景条 `#F2F2F2`，字段间隔分布，高度约 40px

---

## 【新开发】一-2、顶部操作栏（新增）

位于业务信息栏上方，包含操作按钮：

| 按钮 | 类型 | 图标 | 说明 |
|------|------|------|------|
| 保存 | 主按钮(primary) | layui-icon-ok | 保存表单数据 |
| 关闭 | 普通按钮 | layui-icon-close | 关闭当前标签页 |

**样式**：
- 背景：白色
- 内边距：15px 20px
- 按钮间距：10px

---

## 【新开发】二、步骤导航（左侧）

垂直导航菜单，包含多个步骤项：

| 步骤 | 状态 |
|------|------|
| 申请信息 | 当前（蓝色高亮） |
| 其他目录 | 未激活 |
| 其他目录 | 未激活 |

**样式**：
- 激活状态：蓝色字体 `#1890ff` + 左侧蓝色竖条（3px宽）
- 未激活：灰色字体 `#666`
- 背景：白色
- 每项高度：约 45px
- 左侧竖条：width 3px，height 16px，background #1890ff

---

## 【新开发】三、表单区域

### 表单字段

| 字段名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| 业务类型 | 只读文本 | - | 固定值"权属管理"，灰色背景 |
| 办理日期 | 日期选择器 | ✅ | placeholder: 请选择，带日历图标 |
| 来文标题 | 文本输入 | ✅ | placeholder: 请输入 |
| 来文文号 | 文本输入 | ✅ | placeholder: 请输入 |
| 申请单位 | 文本+按钮 | ✅ | 输入框 + [选择] + [清除] 按钮 |
| 关联楼宇 | 文本+按钮 | | 输入框 + [选择] + [清除] 按钮 |
| 联系人 | 文本输入 | | placeholder: 请输入 |
| 主送单位 | 文本输入 | | placeholder: 请输入 |
| 来文正文 | 文件上传 | | [上传文件] 按钮 + "(上传文件格式为pdf)" |
| 来文附件 | 文件上传 | | [上传文件] 按钮 + "(上传文件格式为pdf)" + 附件列表表格 |

### 表单布局（新）
- **首行两列**：业务类型（左）+ 办理日期（右）
- **其余单列**：每行一个字段
- 标签宽度：约 80px，右对齐
- 输入框宽度：自适应填充
- 标签与输入框间距：20px
- 行间距：约 15px

### 申请单位/关联楼宇 选择器样式（新）
- 输入框：readonly，显示已选单位/楼宇名称
- [选择] 按钮：主按钮样式，点击弹出选择弹窗
- [清除] 按钮：普通按钮样式，点击清空已选

### 文件上传样式（新）
- [上传文件] 按钮：带上传图标 `layui-icon-upload`
- 提示文字："(上传文件格式为pdf)"，灰色

### 来文附件列表表格（新增）
上传附件后，下方显示已上传文件列表：

| 列名 | 说明 |
|------|------|
| 文件名称 | 显示文件名，如"业务来文附件示例（1）.pdf" |
| 上传时间 | 格式：yyyy-MM-dd HH:mm:ss |
| 文件大小 | 如"499 KB" |
| 操作 | [预览] [下载] 链接 |

### 底部操作
- 无（保存按钮已移至顶部操作栏）

---

## 四、样式规范

### 项目主题色（来源：`src/store/app.ts`）
| CSS 变量 | 色值 | 用途 |
|----------|------|------|
| `--global-primary-color` | #009688 | 主色（青色） |
| `--global-normal-color` | #1e9fff | 常规色（蓝色） |
| `--global-checked-color` | #5fb878 | 选中/成功色（绿色） |
| `--global-danger-color` | #ff5722 | 危险色（红色） |
| `--global-warm-color` | #ffb800 | 警告色（黄色） |
| `--global-border-radius` | 4px | 圆角 |

### 页面专用颜色
| 用途 | 色值 |
|------|------|
| 业务信息栏背景 | #F2F2F2 |
| 只读字段背景 | #EAEAEA |
| 必填标记 | var(--global-danger-color) |
| 步骤导航激活 | #1890ff（蓝色，非绿色） |
| 步骤导航左侧竖条 | #1890ff |
| 按钮 | var(--global-normal-color) |

### 输入框
- 高度：38px
- 边框：1px solid #E6E6E6
- 圆角：2px
- 聚焦边框：#1E9FFF

### 按钮
- 主按钮：蓝色背景 #1E9FFF，白色文字
- 高度：32px
- 圆角：2px

---

## 五、交互说明

### 1. 申请单位选择（更新）
- 点击 [选择] 按钮 → 弹出单位选择弹窗
- 支持搜索过滤
- 选择后回填单位名称到输入框
- 点击 [清除] 按钮 → 清空已选单位

### 2. 关联楼宇选择（更新）
- 点击 [选择] 按钮 → 弹出楼宇选择弹窗
- 可能依赖已选择的申请单位进行筛选
- 点击 [清除] 按钮 → 清空已选楼宇

### 3. 文件上传（更新）
- 点击 [上传文件] 按钮 → 打开文件选择器
- 仅支持 PDF 格式
- **来文正文**：单文件上传，上传后显示文件名
- **来文附件**：多文件上传，上传后在下方表格中展示
  - 表格列：文件名称、上传时间、文件大小、操作
  - 操作：预览（新窗口打开）、下载

### 4. 表单保存（更新）
- 点击顶部操作栏 [保存] 按钮 → 校验必填字段
- 校验失败 → 提示错误信息
- 校验成功 → 提交数据 → 提示"保存成功，已提交到下一个环节" → 重新初始化页面（清空表单，获取新的业务编号）

### 5. 关闭操作（新增）
- 点击顶部操作栏 [关闭] 按钮 → 关闭当前标签页
- 点击标签页 ✕ → 关闭标签页

---

## 六、数据结构与 Mock

### 表单数据模型
```typescript
interface OwnershipApplication {
  businessType: string       // 业务类型（只读）
  handleDate: string         // 办理日期
  documentTitle: string      // 来文标题
  documentNumber: string     // 来文文号
  applicantUnitId: string    // 申请单位ID
  applicantUnitName: string  // 申请单位名称（展示用）
  relatedBuildingId?: string // 关联楼宇ID
  relatedBuildingName?: string // 关联楼宇名称（展示用）
  contactPerson?: string     // 联系人
  mainRecipient?: string     // 主送单位
  documentContent?: File     // 来文正文（文件）
  documentAttachments: AttachmentFile[]  // 来文附件（多文件）
}

// 附件文件（新增）
interface AttachmentFile {
  id: string           // 文件ID
  name: string         // 文件名称
  uploadTime: string   // 上传时间
  size: number         // 文件大小（字节）
  url: string          // 文件URL（用于预览/下载）
}
```

### 业务信息（页面初始化获取）
```typescript
interface BusinessInfo {
  businessType: string    // 办公用房-权属申请
  businessNo: string      // 2026011400001
  handler: string         // 曾启松
  currentStep: string     // 申请
}
```

### 单位数据
```typescript
interface Unit {
  id: string
  name: string
  code: string      // 单位编码
  contact?: string  // 联系人
  phone?: string    // 联系电话
}
```

### 楼宇数据
```typescript
interface Building {
  id: string
  name: string
  address: string   // 地址
  unitId?: string   // 所属单位ID（可选，用于筛选）
}
```

---

## 七、Mock 接口设计

在 `src/mockjs/` 下新增 `business.ts`：

### 1. 获取业务信息（页面初始化）
```typescript
// GET /api/business/ownership/init
let businessNoSeq = 1

const getBusinessInit = () => {
  // 生成业务编号：年月日 + 5位序号
  const date = new Date()
  const dateStr = `${date.getFullYear()}${String(date.getMonth() + 1).padStart(2, '0')}${String(date.getDate()).padStart(2, '0')}`
  const businessNo = `${dateStr}${String(businessNoSeq++).padStart(5, '0')}`

  return {
    code: 200,
    data: {
      businessType: '办公用房-权属申请',
      businessNo: businessNo,
      handler: '曾启松',
      currentStep: '申请'
    }
  }
}
```

### 2. 查询单位列表（支持搜索）
```typescript
// GET /api/unit/list?keyword=xxx
const unitList = [
  { id: '1', name: '市财政局', code: 'CZJ', contact: '张三', phone: '0591-88888881' },
  { id: '2', name: '市发改委', code: 'FGW', contact: '李四', phone: '0591-88888882' },
  { id: '3', name: '市教育局', code: 'JYJ', contact: '王五', phone: '0591-88888883' },
  { id: '4', name: '市人社局', code: 'RSJ', contact: '赵六', phone: '0591-88888884' },
  { id: '5', name: '市住建局', code: 'ZJJ', contact: '钱七', phone: '0591-88888885' },
]

const getUnitList = (req: any) => {
  const { keyword } = JSON.parse(req.body || '{}')
  let result = unitList
  if (keyword) {
    result = unitList.filter(item =>
      item.name.includes(keyword) || item.code.includes(keyword)
    )
  }
  // 模拟异步延迟
  return {
    code: 200,
    data: result
  }
}
```

### 3. 查询楼宇列表（支持搜索）
```typescript
// GET /api/building/list?keyword=xxx&unitId=xxx
const buildingList = [
  { id: '1', name: '行政中心A栋', address: '市府路1号', unitId: '1' },
  { id: '2', name: '行政中心B栋', address: '市府路1号', unitId: '1' },
  { id: '3', name: '财政综合楼', address: '鼓楼路88号', unitId: '1' },
  { id: '4', name: '发改委办公楼', address: '华林路100号', unitId: '2' },
  { id: '5', name: '教育大厦', address: '五四路200号', unitId: '3' },
  { id: '6', name: '人才服务中心', address: '东街150号', unitId: '4' },
]

const getBuildingList = (req: any) => {
  const { keyword, unitId } = JSON.parse(req.body || '{}')
  let result = buildingList
  if (unitId) {
    result = result.filter(item => item.unitId === unitId)
  }
  if (keyword) {
    result = result.filter(item =>
      item.name.includes(keyword) || item.address.includes(keyword)
    )
  }
  return {
    code: 200,
    data: result
  }
}
```

### 4. 保存申请表单
```typescript
// POST /api/business/ownership/save
const saveApplication = (req: any) => {
  const data = JSON.parse(req.body)
  console.log('保存申请数据:', data)
  return {
    code: 200,
    msg: '保存成功，已提交到下一个环节',
    data: { id: Date.now().toString() }
  }
}
```

### Mock 注册（index.ts）
```typescript
import Mock from 'mockjs'

Mock.mock('/api/business/ownership/init', 'get', getBusinessInit)
Mock.mock(/\/api\/unit\/list/, 'post', getUnitList)
Mock.mock(/\/api\/building\/list/, 'post', getBuildingList)
Mock.mock('/api/business/ownership/save', 'post', saveApplication)

// 设置延迟模拟真实网络
Mock.setup({ timeout: '200-500' })
```

---

## 八、实现要点

### 1. 路由配置
```typescript
{
  path: '/business/ownership',
  name: 'OwnershipApplication',
  component: () => import('@/views/business/ownership/index.vue'),
  meta: { title: '权属申请' }
}
```

### 2. 组件拆分建议
```
views/business/ownership/
├── index.vue           # 页面入口
├── components/
│   ├── ActionBar.vue        # 顶部操作栏（新增）
│   ├── BusinessHeader.vue   # 业务信息栏
│   ├── StepNav.vue          # 步骤导航（需修改样式）
│   ├── ApplicationForm.vue  # 申请表单（需修改）
│   └── AttachmentTable.vue  # 附件列表表格（新增）
```

### 3. 依赖组件
- `lay-date-picker`：日期选择
- `lay-input`：文本输入
- `lay-upload`：文件上传
- `lay-button`：按钮
- 自定义：单位选择器、楼宇选择器

---

## 九、开发清单

### 需新增的文件
```
src/views/business/ownership/components/
├── ActionBar.vue            # 顶部操作栏（新增）
└── AttachmentTable.vue      # 附件列表表格（新增）
```

### 需修改的文件
```
src/views/business/ownership/
├── index.vue                # 添加操作栏，调整布局
└── components/
    ├── StepNav.vue          # 修改样式：蓝色高亮+左侧竖条
    └── ApplicationForm.vue  # 修改：首行两列、选择/清除按钮、文件上传样式、附件列表
```

### 修改详情

#### 1. index.vue
- 引入并添加 `ActionBar` 组件
- 将保存逻辑移至 ActionBar
- 添加关闭标签页功能

#### 2. StepNav.vue
- 修改激活状态样式：绿色 → 蓝色 (#1890ff)
- 添加左侧蓝色竖条
- 扩展步骤项（申请信息、其他目录、其他目录）

#### 3. ApplicationForm.vue
- 首行改为两列布局（业务类型 + 办理日期）
- 申请单位/关联楼宇：搜索图标 → [选择][清除]按钮
- 文件上传：添加"(上传文件格式为pdf)"提示
- 来文附件：添加 AttachmentTable 组件展示已上传文件
- 移除底部保存按钮

#### 4. ActionBar.vue（新增）
- 包含 [保存] 和 [关闭] 按钮
- 发射 save、close 事件

#### 5. AttachmentTable.vue（新增）
- 展示已上传附件列表
- 列：文件名称、上传时间、文件大小、操作
- 操作：预览、下载

### 开发步骤（更新后）
1. ~~新增 Mock 接口~~ ✅ 已完成
2. ~~新增 API 模块~~ ✅ 已完成
3. ~~配置菜单路由~~ ✅ 已完成
4. ~~创建基础页面~~ ✅ 已完成
5. 新增 ActionBar.vue 顶部操作栏
6. 修改 StepNav.vue 样式
7. 修改 ApplicationForm.vue 表单布局和交互
8. 新增 AttachmentTable.vue 附件列表
