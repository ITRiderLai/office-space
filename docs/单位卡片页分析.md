# 单位卡片页分析文档

## 1. 页面概述

单位卡片页是单位管理模块下的子页面，用于展示单位的详细信息。页面采用左右分栏布局，左侧为组织架构目录树，右侧为选中单位的详情卡片，包含基本信息、人员编制、实有人数、办公室使用面积等多个信息区块。

## 2. 页面位置

- **菜单路径**：单位管理 > 单位卡片
- **路由建议**：`/unit/card`

## 3. 页面结构

```
┌─────────────────────────────────────────────────────────────────────────────┐
│ 顶部导航栏（复用）                                                            │
├───────┬─────────────────────────────────────────────────────────────────────┤
│       │ 标签页区域（复用）                                                    │
│ 左    ├─────────────────────────────────────────────────────────────────────┤
│ 侧    │                                                                     │
│ 菜    │ ┌─────────────────┬─────────────────────────────────────────────────┤
│ 单    │ │  目录区域        │   单位详情卡片区域                               │
│ 栏    │ │                 │                                                 │
│       │ │ ┌─────────────┐ │ ┌─────────────────────────────────────────────┐ │
│ (     │ │ │ 目录    [≡] │ │ │ ┌─────────┐  单位名称: xxx   单位级别: xxx │ │
│ 复    │ │ ├─────────────┤ │ │ │         │  编制人数: xxx   实有人数: xxx │ │
│ 用    │ │ │ [搜索输入框] │ │ │ │  照片   │  分管领导: xxx   单位法人: xxx │ │
│ )     │ │ ├─────────────┤ │ │ │         │  移动电话: xxx   办公电话: xxx │ │
│       │ │ │   [刷新]    │ │ │ └─────────┘  办公地址: xxxxxxxxx         │ │
│       │ │ │             │ │ │   [查看全景照片]                             │ │
│       │ │ │             │ │ └─────────────────────────────────────────────┘ │
│       │ │ │  云南省      │ │                                                 │
│       │ │ │  ├ 昆明市   │ │ ┌─────────────────────────────────────────────┐ │
│       │ │ │  ├ 曲靖市   │ │ │ 人员编制（单位按照编制人数）    [面积核算表]  │ │
│       │ │ │  ├ 玉溪市   │ │ │                                               │ │
│       │ │ │  └ 保山市   │ │ │  正省级  10    副省级  20    正厅级  15       │ │
│       │ │ │    ├ 市直   │ │ │  副厅级  10    正处级  14    副处级  30       │ │
│       │ │ │    │ └ ...  │ │ │  处级以下 11                                  │ │
│       │ │ │    └ 各县   │ │ │                                               │ │
│       │ │ │             │ │ └─────────────────────────────────────────────┘ │
│       │ │ │  (选中高亮)  │ │                                                 │
│       │ │ │             │ │                                                 │
│       │ │ └─────────────┘ │                                                 │
│       │ │                 │ ┌─────────────────────────────────────────────┐ │
│       │ │                 │ │ 实有人数（人数）                              │ │
│       │ │                 │ │ ┌────────┬────────┬────────┬────────┬─────┐ │ │
│       │ │                 │ │ │市级正职│市级副职│正局(处)│副局(处)│局级↓│ │ │
│       │ │                 │ │ ├────────┼────────┼────────┼────────┼─────┤ │ │
│       │ │                 │ │ │  10    │  20    │  15    │  15    │ 15  │ │ │
│       │ │                 │ └─────────────────────────────────────────────┘ │
│       │ │                 │                                                 │
│       │ │                 │ ┌─────────────────────────────────────────────┐ │
│       │ │                 │ │ 办公室使用面积                               │ │
│       │ │                 │ │ （详细数据展示区域）                          │ │
│       │ │                 │ └─────────────────────────────────────────────┘ │
│       │ │                 │                                                 │
│       │ │                 │ ┌─────────────────────────────────────────────┐ │
│       │ │                 │ │ 办公室使用面积（房屋实有人数）               │ │
│       │ │                 │ │ （详细数据展示区域）                          │ │
│       │ └─────────────────┴─────────────────────────────────────────────────┤
└───────┴─────────────────────────────────────────────────────────────────────┘
```

## 4. 功能模块详解

### 4.1 目录树区域

#### 4.1.1 目录头部

| 元素 | 说明 |
|-----|------|
| 标题 | "目录" |
| 折叠图标 | 右上角，点击可收起/展开整个目录树区域 |

#### 4.1.2 搜索框

| 字段 | 组件类型 | 说明 |
|-----|---------|------|
| 搜索 | lay-input | placeholder="请输入"，支持模糊搜索单位名称 |

#### 4.1.3 操作按钮

| 按钮 | 功能说明 | 交互逻辑 |
|-----|---------|---------|
| 刷新 | 刷新目录树 | 重新加载目录数据 |

#### 4.1.4 树形结构

| 特性 | 说明 |
|-----|------|
| 层级结构 | 省 > 市 > 区/县/市直 > 单位 |
| 展开/折叠 | 点击箭头图标展开或折叠子节点 |
| 选中高亮 | 当前选中的节点蓝色高亮显示 |
| 联动 | 选中节点后，右侧显示对应单位的详情卡片 |

### 4.2 单位详情卡片区域

#### 4.2.1 基本信息卡片（头部）

**布局**：左侧图片区 + 右侧信息区

**图片区**：
- 单位全景照片
- 照片下方有"查看全景照片"按钮

**信息区字段**：

| 字段名 | 字段标识 | 布局位置 |
|-------|---------|---------|
| 单位名称 | unitName | 第1行左 |
| 单位级别 | unitLevel | 第1行右 |
| 编制人数 | establishedCount | 第2行左 |
| 实有人数 | actualCount | 第2行右 |
| 分管领导 | supervisor | 第3行左 |
| 单位法人 | legalPerson | 第3行右 |
| 移动电话 | mobilePhone | 第4行左 |
| 办公电话 | officePhone | 第4行右 |
| 办公地址 | officeAddress | 第5行（跨两列） |

#### 4.2.2 人员编制区块

**标题**：人员编制（单位按照编制人数）

**右侧按钮**：面积核算表（点击打开面积核算表弹窗，只读预览）

**字段数据**：

| 级别 | 字段标识 |
|-----|---------|
| 正省级 | provincialLevel |
| 副省级 | deputyProvincialLevel |
| 正厅级 | departmentLevel |
| 副厅级 | deputyDepartmentLevel |
| 正处级 | divisionLevel |
| 副处级 | deputyDivisionLevel |
| 处级以下 | belowDivisionLevel |

**布局**：表单布局，每行3列（label在左，值在右）

```
┌──────────────────────────────────────────────────────────┐
│ 正省级    10       副省级    20       正厅级    15       │
│ 副厅级    10       正处级    14       副处级    30       │
│ 处级以下  11                                             │
└──────────────────────────────────────────────────────────┘
```

#### 4.2.3 实有人数区块

**标题**：实有人数（人数）

**表格数据**：

| 级别 | 字段标识 |
|-----|---------|
| 市级正职 | cityChief |
| 市级副职 | cityDeputy |
| 正局（处）级 | bureauLevel |
| 副局（处）级 | deputyBureauLevel |
| 局（处）级以下 | belowBureauLevel |

**布局**：5列 x 1行展示

#### 4.2.4 办公室使用面积区块

**标题**：办公室使用面积

**内容**：（设计稿中未展示详细内容，待补充）

#### 4.2.5 办公室使用面积（房屋实有人数）区块

**标题**：办公室使用面积（房屋实有人数）

**表格数据**：

| 级别 | 字段标识 |
|-----|---------|
| 市级正职 | cityChief |
| 市级副职 | cityDeputy |
| 正局（处）级 | bureauLevel |
| 副局（处）级 | deputyBureauLevel |
| 局（处）级以下 | belowBureauLevel |

**布局**：5列 x 1行展示（与实有人数区块结构相同）

### 4.3 面积核算表弹窗

**触发**：点击人员编制区块右侧的「面积核算表」按钮

**性质**：只读预览，不可编辑

**功能说明**：根据单位人员编制数据和各级别办公面积标准，自动计算该单位应有的办公面积配额。

**弹窗内容**：

| 级别 | 人数 | 面积标准（㎡/人） | 应有面积（㎡） |
|-----|------|----------------|--------------|
| 正省级 | 10 | 54 | 540 |
| 副省级 | 20 | 42 | 840 |
| 正厅级 | 15 | 30 | 450 |
| 副厅级 | 10 | 24 | 240 |
| 正处级 | 14 | 18 | 252 |
| 副处级 | 30 | 12 | 360 |
| 处级以下 | 11 | 9 | 99 |
| **合计** | **110** | - | **2781** |

**数据来源**：
- 人数：来自单位的人员编制数据
- 面积标准：来自系统基础配置（各级别办公面积标准）
- 应有面积：自动计算（人数 × 面积标准）

**用途**：
- 核算单位应配办公面积总量
- 对比实际使用面积，判断是否超标/不足
- 为办公用房分配、调整提供依据

## 5. 数据结构

### 5.1 组织架构树节点

```typescript
interface OrgTreeNode {
  id: string                    // 节点ID
  name: string                  // 节点名称
  type: 'province' | 'city' | 'district' | 'unit'  // 节点类型
  parentId?: string             // 父节点ID
  children?: OrgTreeNode[]      // 子节点
  level?: number                // 层级深度
}
```

### 5.2 单位详情数据

```typescript
interface UnitDetail {
  id: string                    // 单位ID
  unitName: string              // 单位名称
  unitLevel: string             // 单位级别（正厅级、副厅级等）
  establishedCount: number      // 编制人数
  actualCount: number           // 实有人数
  supervisor: string            // 分管领导
  legalPerson: string           // 单位法人
  mobilePhone: string           // 移动电话
  officePhone: string           // 办公电话
  officeAddress: string         // 办公地址
  panoramaPhoto?: string        // 全景照片URL

  // 人员编制（按编制人数）
  staffEstablishment: StaffEstablishment

  // 实有人数
  actualStaff: ActualStaff

  // 办公室使用面积（房屋实有人数）
  officeAreaByStaff: OfficeAreaByStaff
}

// 人员编制结构
interface StaffEstablishment {
  provincialLevel: number       // 正省级
  deputyProvincialLevel: number // 副省级
  departmentLevel: number       // 正厅级
  deputyDepartmentLevel: number // 副厅级
  divisionLevel: number         // 正处级
  deputyDivisionLevel: number   // 副处级
  belowDivisionLevel: number    // 处级以下
}

// 实有人数结构
interface ActualStaff {
  cityChief: number             // 市级正职
  cityDeputy: number            // 市级副职
  bureauLevel: number           // 正局（处）级
  deputyBureauLevel: number     // 副局（处）级
  belowBureauLevel: number      // 局（处）级以下
}

// 办公室使用面积（房屋实有人数）- 与实有人数结构相同
interface OfficeAreaByStaff {
  cityChief: number             // 市级正职
  cityDeputy: number            // 市级副职
  bureauLevel: number           // 正局（处）级
  deputyBureauLevel: number     // 副局（处）级
  belowBureauLevel: number      // 局（处）级以下
}

// 面积核算表数据结构
interface AreaCalculationData {
  items: AreaCalculationItem[]  // 各级别核算明细
  totalCount: number            // 人数合计
  totalArea: number             // 应有面积合计
}

// 面积核算明细项
interface AreaCalculationItem {
  level: string                 // 级别名称
  count: number                 // 人数
  standard: number              // 面积标准（㎡/人）
  area: number                  // 应有面积（㎡）= count × standard
}
```

## 6. Mock接口设计

### 6.1 获取组织架构树

```typescript
// GET /unit/org-tree
// 请求参数：{ keyword?: string }  // 搜索关键字（可选）
// 响应数据：
{
  code: 200,
  msg: "操作成功",
  data: OrgTreeNode[],
  success: true
}
```

### 6.2 获取单位详情

```typescript
// GET /unit/detail/:id
// 请求参数：路径参数 id
// 响应数据：
{
  code: 200,
  msg: "操作成功",
  data: UnitDetail,
  success: true
}
```

### 6.3 获取面积核算表

```typescript
// GET /unit/area-calculation/:unitId
// 请求参数：路径参数 unitId
// 响应数据：
{
  code: 200,
  msg: "操作成功",
  data: AreaCalculationData,  // 面积核算表数据
  success: true
}
```

## 7. 组件拆分

```
src/views/unit/card/
├── index.vue                    # 页面主文件
└── components/
    ├── OrgTree.vue              # 组织架构目录树组件
    ├── UnitHeader.vue           # 单位基本信息卡片（头部区域）
    ├── StaffEstablishment.vue   # 人员编制区块组件
    ├── ActualStaff.vue          # 实有人数区块组件
    ├── OfficeArea.vue           # 办公室使用面积组件
    └── AreaCalculationModal.vue # 面积核算表弹窗
```

## 8. 复用说明

| 模块 | 复用情况 | 说明 |
|-----|---------|------|
| 顶部导航栏 | 复用 | 项目已有 |
| 左侧菜单栏 | 复用 | 需添加菜单配置 |
| 标签页区域 | 复用 | 项目已有 |
| 树形组件 | 新开发 | 使用 lay-tree 组件 |
| 卡片布局 | 新开发 | 自定义样式 |

## 9. 样式规范

### 9.1 布局比例

- 目录树区域宽度：约 320px（固定宽度）
- 单位详情区域：flex: 1（自适应剩余宽度）

### 9.2 颜色使用

- 目录树选中项背景：`#1890ff`（蓝色高亮）
- 目录树选中项文字：`#ffffff`
- 区块标题左侧竖线：`#1890ff`
- 区块标题背景：浅蓝色渐变
- 表格边框：`#e8e8e8`

### 9.3 区块标题样式

```css
.section-title {
  display: flex;
  align-items: center;
  padding: 10px 15px;
  background: linear-gradient(to right, #e6f7ff, #ffffff);
  border-left: 3px solid #1890ff;
  font-weight: bold;
  margin-bottom: 15px;
}
```

### 9.4 卡片样式

```css
.card-section {
  background: #ffffff;
  border-radius: 4px;
  padding: 15px;
  margin-bottom: 15px;
  box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
}
```

## 10. 交互细节

### 10.1 目录树操作

1. **收起/展开目录区域**：点击目录头部右侧图标，可收起或展开整个目录树区域
2. **搜索**：输入关键字后自动过滤匹配的节点
3. **刷新**：点击刷新按钮，重新加载目录树数据
4. **展开/折叠节点**：点击节点前的箭头图标
5. **选中**：点击节点名称选中，高亮显示，右侧加载对应详情

### 10.2 详情卡片操作

1. **查看全景照片**：点击按钮，打开图片预览（使用 layui 图片预览组件）
2. **面积核算表**：点击按钮，打开面积核算表弹窗（只读预览，展示各级别人数、面积标准、应有面积的计算结果）

### 10.3 加载状态

- 切换单位时，详情区域显示 loading 状态
- 目录树初始加载时显示 loading 状态

## 11. 开发清单

- [x] 添加菜单配置（单位管理 > 单位卡片）
- [x] 添加路由配置
- [x] 创建Mock数据和接口
- [x] 创建API模块
- [x] 开发页面主文件 index.vue
- [x] 开发组织架构目录树组件 OrgTree.vue
- [x] 开发单位基本信息卡片组件 UnitHeader.vue
- [x] 开发人员编制区块组件 StaffEstablishment.vue
- [x] 开发实有人数区块组件 ActualStaff.vue
- [x] 开发办公室使用面积组件 OfficeArea.vue
- [x] 开发面积核算表弹窗组件 AreaCalculationModal.vue
- [x] 实现目录树搜索功能
- [x] 实现单位详情联动显示
- [x] 样式调整和优化

## 12. 待确认事项

1. **办公室使用面积区块**：设计稿中未完全展示，需补充具体字段和布局
