# 院落编辑页分析文档

## 1. 页面概述

院落编辑页是办公用房管理系统中的核心功能页面，用于管理院落、楼栋、楼层的层级结构，以及楼层图纸的查看和房间绑定操作。

## 2. 页面布局

页面采用左右两栏布局：
- **左侧**：目录树区域（约 200px 宽度）
- **右侧**：主内容区域（自适应宽度）

```
┌─────────────────────────────────────────────────────────────┐
│                        标签页导航栏                           │
├──────────────┬──────────────────────────────────────────────┤
│              │                                              │
│   目录树区域  │              主内容区域                        │
│   (200px)    │           (标签页 + 工具栏 + 图纸)             │
│              │                                              │
│              │                                              │
└──────────────┴──────────────────────────────────────────────┘
```

## 3. 功能模块详解

### 3.1 左侧目录树区域

#### 3.1.1 顶部标题栏
- 标题文字："目录"
- 右侧操作图标（收起/展开目录）

#### 3.1.2 搜索框
- 位置：标题下方
- 占位符："请输入"
- 带搜索图标

#### 3.1.3 操作按钮组
- **刷新**：刷新目录树数据

#### 3.1.4 树形结构
层级结构如下：
```
省份
└── 城市
    └── 区域
        └── [院落]院落名称
            └── [楼栋]楼栋名称
                └── 楼层（1层、2层...）
```

节点类型标识：
| 类型 | 标识前缀 | 示例 |
|------|---------|------|
| 省份 | 无 | 云南省 |
| 城市 | 无 | 昆明市 |
| 区域 | 无 | 市区 |
| 院落 | [院落] | [院落]市委大院 |
| 楼栋 | [楼栋] | [楼栋]主办公楼 |
| 楼层 | 无 | 1层、2层 |

选中状态：
- 当前选中节点：蓝色背景高亮 + 左侧蓝色竖条

### 3.2 右侧主内容区域

#### 3.2.1 标签页导航
三个标签页：
| 标签 | 说明 |
|------|------|
| 楼层图纸 | 显示楼层平面图，支持房间选择和绑定操作（默认选中） |
| 楼层信息 | 显示楼层基本信息 |
| 楼层房屋 | 显示楼层内所有房间列表 |

标签样式：
- 选中状态：蓝色文字 + 下划线
- 未选中状态：灰色文字

#### 3.2.2 工具栏 + 图纸展示区域（预留占位）

> ⚠️ **注意：此部分后续使用私服组件实现，当前只需预留占位容器**

**开发要求：**
- 预留一个占位容器
- 容器添加边框线（便于识别区域位置）
- 后续集成私服组件时替换

**预留容器示例：**
```vue
<div class="floor-plan-placeholder">
  <!-- 后续集成私服组件 -->
</div>

<style>
.floor-plan-placeholder {
  flex: 1;
  border: 1px dashed #d9d9d9;
  border-radius: 4px;
  min-height: 400px;
}
</style>
```

**设计稿参考（供后续集成）：**
- 工具栏按钮：刷新、筛选、框选、取消选择、打印图纸、绑定类型、绑定单位、取消类型绑定、取消单位绑定
- 图纸展示：楼层平面图 + 房间信息（房间号、面积）
- 统计面板：无定义/已定义01/已定义02 的房间数和面积

## 4. 交互设计

### 4.1 目录树交互
1. **节点展开/折叠**：点击节点前的箭头图标
2. **节点选择**：点击节点名称，高亮显示并加载对应内容
3. **搜索过滤**：输入关键字实时过滤树节点
4. **刷新数据**：点击刷新按钮重新加载树数据

### 4.2 图纸交互（后续集成）
> 当前预留占位容器，后续集成私服组件时实现以下交互：
> - 房间选择（单击、框选）
> - 绑定/取消绑定操作
> - 图纸缩放和平移

### 4.3 标签页切换
- 点击标签切换不同视图
- 切换时保持目录树选中状态

## 5. 数据结构

### 5.1 目录树节点
```typescript
interface TreeNode {
  id: string
  name: string
  type: 'province' | 'city' | 'district' | 'courtyard' | 'building' | 'floor'
  parentId: string | null
  children?: TreeNode[]
  // 楼层特有属性
  floorNumber?: number
  // 楼栋特有属性
  buildingCode?: string
  // 院落特有属性
  courtyardCode?: string
}
```

### 5.2 房间数据
```typescript
interface Room {
  id: string
  roomNumber: string      // 房间号，如 "113A"
  area: number            // 面积，单位 m²
  floorId: string         // 所属楼层ID
  typeId?: string         // 绑定的类型ID
  typeName?: string       // 绑定的类型名称
  unitId?: string         // 绑定的单位ID
  unitName?: string       // 绑定的单位名称
  bindStatus: 'none' | 'type1' | 'type2'  // 绑定状态
  position: {             // 在图纸上的位置
    x: number
    y: number
    width: number
    height: number
  }
}
```

### 5.3 楼层统计
```typescript
interface FloorStatistics {
  undefined: {
    count: number
    area: number
  }
  defined01: {
    count: number
    area: number
  }
  defined02: {
    count: number
    area: number
  }
}
```

## 6. 组件复用分析

### 6.1 目录树组件复用

院落编辑页的目录树与单位卡片页(`src/views/unit/card/components/OrgTree.vue`)结构一致，**可以直接复用**。

**现有 OrgTree 组件功能（完全匹配）：**
- 头部：标题"目录" + 收起按钮 ✅
- 搜索框：带搜索图标、防抖搜索 ✅
- 操作按钮：刷新 ✅
- 树形结构：使用 `lay-tree` 组件 ✅
- 选中状态：蓝色文字+加粗 ✅

**复用方式：** 直接引入 `OrgTree.vue` 组件，传入对应的树数据即可。

```vue
<OrgTree
  :tree-data="treeData"
  :loading="treeLoading"
  :selected-id="selectedNodeId"
  @select="handleSelectNode"
  @refresh="loadTreeData"
  @toggle-collapse="toggleTreePanel"
/>
```

### 6.2 组件拆分

```
courtyard/edit/
├── index.vue                    # 主页面
├── components/
│   ├── FloorInfo.vue            # 楼层信息组件
│   └── FloorRooms.vue           # 楼层房屋列表组件
└── types/
    └── index.ts                 # 类型定义

# 复用组件
src/views/unit/card/components/OrgTree.vue  # 目录树组件（直接复用）

# 预留占位（后续集成私服组件）
- 楼层图纸标签页内容区域（工具栏 + 图纸 + 统计面板）
```

## 7. API 接口

### 7.1 目录树相关
```typescript
// 获取目录树数据
GET /api/courtyard/tree

// 搜索节点
GET /api/courtyard/tree/search?keyword={keyword}
```

### 7.2 楼层图纸相关
```typescript
// 获取楼层图纸数据（包含房间信息）
GET /api/floor/{floorId}/plan

// 获取楼层统计
GET /api/floor/{floorId}/statistics

// 绑定房间类型
POST /api/room/bindType
Body: { roomIds: string[], typeId: string }

// 绑定房间单位
POST /api/room/bindUnit
Body: { roomIds: string[], unitId: string }

// 取消类型绑定
POST /api/room/unbindType
Body: { roomIds: string[] }

// 取消单位绑定
POST /api/room/unbindUnit
Body: { roomIds: string[] }
```

### 7.3 楼层信息相关
```typescript
// 获取楼层信息
GET /api/floor/{floorId}/info

// 更新楼层信息
PUT /api/floor/{floorId}/info
Body: { ... }
```

### 7.4 楼层房屋相关
```typescript
// 获取楼层房屋列表
GET /api/floor/{floorId}/rooms?page={page}&pageSize={pageSize}
```

## 8. 技术要点

### 8.1 图纸区域（预留占位）
- 当前只需预留带边框的占位容器
- 后续集成私服组件时替换

### 8.2 树形结构
- 直接复用 `OrgTree.vue` 组件
- 使用 lay-tree 组件渲染
- 支持搜索过滤和刷新

### 8.3 状态管理
- 当前选中的树节点
- 当前激活的标签页

## 9. 开发清单

- [x] 创建页面基础布局（左右两栏）
- [x] 复用目录树组件（直接使用 `src/views/unit/card/components/OrgTree.vue`）
- [x] 实现标签页切换（楼层图纸 | 楼层信息 | 楼层房屋）
- [x] 楼层图纸标签页：预留占位容器（添加边框线）
- [x] 实现楼层信息模块
- [x] 实现楼层房屋模块
- [x] API 对接
- [x] Mock 数据准备
- [x] 路由配置
