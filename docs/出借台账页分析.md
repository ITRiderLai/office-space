# 出借台账页分析文档

## 1. 页面概述

出借台账页是数据台账模块下的子页面，用于管理和查询办公用房的出借记录。页面采用典型的列表查询页面布局，包含搜索筛选区、操作按钮区和数据表格区。

## 2. 页面位置

- **菜单路径**：数据台账 > 出借台账
- **路由建议**：`/ledger/lending`

## 3. 页面结构

```
┌─────────────────────────────────────────────────────────────┐
│ 顶部导航栏（复用）                                            │
├───────┬─────────────────────────────────────────────────────┤
│       │ 标签页区域（复用）                                    │
│ 左    ├─────────────────────────────────────────────────────┤
│ 侧    │ 操作按钮区（靠右）：          [新增] [编辑] [删除] [导出] │
│ 菜    ├─────────────────────────────────────────────────────┤
│ 单    │ 搜索筛选区                                           │
│ 栏    │ ┌─────────┬─────────┬─────────┬─────────┐          │
│       │ │单位名称  │单位性质  │产权人    │产权证号  │          │
│ (     │ ├─────────┼─────────┼─────────┼─────────┤          │
│ 复    │ │承租人    │性质     │合同编号  │[搜索][重置]│         │
│ 用    │ └─────────┴─────────┴─────────┴─────────┘          │
│ )     ├─────────────────────────────────────────────────────┤
│       │ 数据表格区                                           │
│       │ ┌───┬──────┬──────┬──────┬────┬──────────┐        │
│       │ │ ☐ │单位名称│填报单位│单位性质│楼宇│出租房产地址│        │
│       │ ├───┼──────┼──────┼──────┼────┼──────────┤        │
│       │ │   │ ...  │ ...  │ ...  │... │   ...    │        │
│       │ └───┴──────┴──────┴──────┴────┴──────────┘        │
│       ├─────────────────────────────────────────────────────┤
│       │ 分页区：共X条数据（左）          [1][2][3]...[10条/页]（右）│
└───────┴─────────────────────────────────────────────────────┘
```

## 4. 功能模块详解

### 4.1 操作按钮区

| 按钮 | 图标 | 功能说明 | 交互逻辑 |
|-----|------|---------|---------|
| 新增 | layui-icon-add-1 | 新增出借记录 | 打开空白编辑弹窗 |
| 编辑 | layui-icon-edit | 编辑选中的行 | 需勾选一行数据，多选提示"只能选择一条数据"，打开编辑弹窗 |
| 删除 | layui-icon-delete | 删除选中的行 | 支持批量删除，需二次确认 |
| 导出 | layui-icon-export | 导出数据为Excel | 导出当前筛选条件下的所有数据 |

**按钮状态逻辑**：

| 状态 | 新增 | 编辑 | 删除 | 导出 |
|-----|------|------|------|------|
| 未选中任何行 | 可用 | 禁用 | 禁用 | 可用 |
| 选中一行 | 可用 | 可用 | 可用 | 可用 |
| 选中多行 | 可用 | 禁用 | 可用 | 可用 |

### 4.2 搜索筛选区

| 字段名 | 字段标识 | 组件类型 | 说明 |
|-------|---------|---------|------|
| 单位名称 | unitName | lay-input | 模糊搜索 |
| 单位性质 | unitType | lay-input | 模糊搜索 |
| 产权人 | propertyOwner | lay-input | 模糊搜索 |
| 产权证号 | propertyCertNo | lay-input | 模糊搜索 |
| 承租人 | lessee | lay-input | 模糊搜索 |
| 性质 | nature | lay-select | 下拉选择 |
| 合同编号 | contractNo | lay-input | 模糊搜索 |

**操作按钮**：
- **搜索**：根据筛选条件查询数据
- **重置**：清空所有筛选条件，恢复默认查询

### 4.3 数据表格区

| 列名 | 字段标识 | 宽度建议 | 功能 |
|-----|---------|---------|------|
| 选择列 | - | 50px | 复选框，用于批量操作选择 |
| 单位名称 | unitName | 120px | 支持排序 |
| 填报单位 | reportUnitId | 180px | 支持排序 |
| 单位性质 | unitType | 100px | - |
| 楼宇 | building | 80px | - |
| 出租房产地址 | address | 200px | - |
| 产权人 | owner | 100px | - |
| 产权证号 | certNo | 120px | - |
| 出租面积 | rentArea | 100px | - |
| 承租人 | tenant | 100px | - |
| 租赁开始时间 | startDate | 120px | - |
| 租赁结束时间 | endDate | 120px | - |
| 批准部门 | approvalDept | 120px | - |
| 是否违规 | violation | 80px | - |
| 违规类型 | violationType | 100px | - |
| 整改措施 | rectifyMeasure | 150px | - |
| 整改中存在的突出问题 | existingIssue | 180px | - |
| 整改后情况 | rectifyStatus | 120px | - |

### 4.4 分页区

采用左右分布布局：
- **左侧 - 数据统计**：显示总条数和当前显示范围（如：共 0 条数据，此页显示01-10条数据）
- **右侧 - 分页器**：
  - 页码导航：支持页码点击、上一页/下一页
  - 每页条数：下拉选择，选项：10条/页、20条/页、50条/页、100条/页

### 4.5 编辑弹窗

由于表格字段较多（18列），采用**弹窗编辑**方式，将字段分组展示。

**弹窗规格**：
- 宽度：800px
- 高度：自适应（内容超出时内部滚动）
- 标题：新增时"新增出借记录"，编辑时"编辑出借记录"
- 底部按钮：靠右排列，[取消] [确定]

**字段分组布局**：

```
┌─────────────────── 编辑出借记录 ───────────────────┐
│                                                   │
│ 【基本信息】                                       │
│ ┌───────────┐ ┌───────────┐ ┌───────────┐        │
│ │ 单位名称   │ │ 填报单位   │ │ 单位性质   │        │
│ └───────────┘ └───────────┘ └───────────┘        │
│ ┌───────────┐ ┌─────────────────────────┐        │
│ │ 楼宇      │ │ 出租房产地址             │        │
│ └───────────┘ └─────────────────────────┘        │
│                                                   │
│ 【产权信息】                                       │
│ ┌───────────┐ ┌───────────┐ ┌───────────┐        │
│ │ 产权人     │ │ 产权证号   │ │ 出租面积   │        │
│ └───────────┘ └───────────┘ └───────────┘        │
│                                                   │
│ 【租赁信息】                                       │
│ ┌───────────┐ ┌───────────┐ ┌───────────┐        │
│ │ 承租人     │ │ 租赁开始   │ │ 租赁结束   │        │
│ └───────────┘ └───────────┘ └───────────┘        │
│ ┌───────────┐                                    │
│ │ 批准部门   │                                    │
│ └───────────┘                                    │
│                                                   │
│ 【违规整改】                                       │
│ ┌───────────┐ ┌───────────┐                      │
│ │ 是否违规   │ │ 违规类型   │                      │
│ └───────────┘ └───────────┘                      │
│ ┌─────────────────────────────────────────┐      │
│ │ 整改措施（textarea，3行）                 │      │
│ └─────────────────────────────────────────┘      │
│ ┌─────────────────────────────────────────┐      │
│ │ 整改中存在的突出问题（textarea，3行）      │      │
│ └─────────────────────────────────────────┘      │
│ ┌─────────────────────────────────────────┐      │
│ │ 整改后情况（textarea，3行）               │      │
│ └─────────────────────────────────────────┘      │
│                                                   │
│                           [取消]  [确定]          │
└───────────────────────────────────────────────────┘
```

**表单字段明细**：

| 分组 | 字段名 | 组件类型 | 是否必填 | 说明 |
|-----|-------|---------|---------|------|
| 基本信息 | 单位名称 | lay-input | 是 | - |
| 基本信息 | 填报单位 | lay-input | 是 | - |
| 基本信息 | 单位性质 | lay-input | 否 | - |
| 基本信息 | 楼宇 | lay-input | 否 | - |
| 基本信息 | 出租房产地址 | lay-input | 否 | 占两列宽度 |
| 产权信息 | 产权人 | lay-input | 否 | - |
| 产权信息 | 产权证号 | lay-input | 否 | - |
| 产权信息 | 出租面积 | lay-input-number | 否 | 单位：㎡ |
| 租赁信息 | 承租人 | lay-input | 否 | - |
| 租赁信息 | 租赁开始时间 | lay-date-picker | 否 | yyyy-MM-dd |
| 租赁信息 | 租赁结束时间 | lay-date-picker | 否 | yyyy-MM-dd |
| 租赁信息 | 批准部门 | lay-input | 否 | - |
| 违规整改 | 是否违规 | lay-select | 否 | 选项：是/否 |
| 违规整改 | 违规类型 | lay-input | 否 | 是否违规=是时显示 |
| 违规整改 | 整改措施 | lay-textarea | 否 | 是否违规=是时显示 |
| 违规整改 | 整改中存在的突出问题 | lay-textarea | 否 | 是否违规=是时显示 |
| 违规整改 | 整改后情况 | lay-textarea | 否 | 是否违规=是时显示 |

**交互说明**：
- "是否违规"选择"否"时，隐藏违规类型、整改措施、存在问题、整改后情况字段
- "是否违规"选择"是"时，显示上述字段
- 点击"取消"关闭弹窗，不保存
- 点击"确定"验证表单，通过后保存并关闭弹窗，刷新列表

## 5. 数据结构

### 5.1 出借记录数据结构

```typescript
interface LendingRecord {
  id: string                    // 记录ID
  unitName: string              // 单位名称
  reportUnitId: string          // 填报单位ID
  unitType: string              // 单位性质
  building: string              // 楼宇
  address: string               // 出租房产地址
  owner: string                 // 产权人
  certNo: string                // 产权证号
  rentArea: number              // 出租面积
  tenant: string                // 承租人
  startDate: string             // 租赁开始时间
  endDate: string               // 租赁结束时间
  approvalDept: string          // 批准部门
  violation: string             // 是否违规（是/否）
  violationType?: string        // 违规类型
  rectifyMeasure?: string       // 整改措施
  existingIssue?: string        // 整改中存在的突出问题
  rectifyStatus?: string        // 整改后情况
  createTime?: string           // 创建时间
  updateTime?: string           // 更新时间
}
```

### 5.2 查询参数结构

```typescript
interface LendingQueryParams {
  unitName?: string             // 单位名称
  unitType?: string             // 单位性质
  propertyOwner?: string        // 产权人
  propertyCertNo?: string       // 产权证号
  lessee?: string               // 承租人
  nature?: string               // 性质
  contractNo?: string           // 合同编号
  page: number                  // 当前页码
  pageSize: number              // 每页条数
  sortField?: string            // 排序字段
  sortOrder?: 'asc' | 'desc'    // 排序方向
}
```

## 6. Mock接口设计

### 6.1 获取出借台账列表

```typescript
// POST /ledger/lending/list
// 请求参数：LendingQueryParams
// 响应数据：
{
  code: 200,
  msg: "操作成功",
  data: {
    list: LendingRecord[],
    total: number,
    page: number,
    pageSize: number
  },
  success: true
}
```

### 6.2 删除出借记录

```typescript
// POST /ledger/lending/delete
// 请求参数：{ ids: string[] }
// 响应数据：
{
  code: 200,
  msg: "删除成功",
  success: true
}
```

### 6.3 保存/更新出借记录

```typescript
// POST /ledger/lending/save
// 请求参数：LendingRecord
// 响应数据：
{
  code: 200,
  msg: "保存成功",
  success: true
}
```

### 6.4 导出出借台账

```typescript
// POST /ledger/lending/export
// 请求参数：LendingQueryParams（不含分页）
// 响应数据：文件流（实际Mock可返回成功提示）
{
  code: 200,
  msg: "导出成功",
  success: true
}
```

### 6.5 获取性质下拉选项

```typescript
// GET /ledger/nature/options
// 响应数据：
{
  code: 200,
  msg: "操作成功",
  data: [
    { value: '1', label: '临时出借' },
    { value: '2', label: '长期出借' },
    { value: '3', label: '有偿出借' },
    { value: '4', label: '无偿出借' }
  ],
  success: true
}
```

### 6.6 导出Excel（前端实现）

导出功能在前端实现，使用 `xlsx` 库将当前数据导出为Excel文件。

**安装依赖**：
```bash
pnpm add xlsx file-saver
pnpm add -D @types/file-saver
```

**导出逻辑**：
```typescript
import * as XLSX from 'xlsx'
import { saveAs } from 'file-saver'

// 导出Excel
const exportExcel = (data: LendingRecord[], filename: string = '出借台账') => {
  // 定义表头映射
  const headers = {
    unitName: '单位名称',
    reportUnitId: '填报单位',
    unitType: '单位性质',
    building: '楼宇',
    address: '出租房产地址',
    owner: '产权人',
    certNo: '产权证号',
    rentArea: '出租面积',
    tenant: '承租人',
    startDate: '租赁开始时间',
    endDate: '租赁结束时间',
    approvalDept: '批准部门',
    violation: '是否违规',
    violationType: '违规类型',
    rectifyMeasure: '整改措施',
    existingIssue: '整改中存在的突出问题',
    rectifyStatus: '整改后情况'
  }

  // 转换数据格式
  const exportData = data.map(item => {
    const row: Record<string, any> = {}
    Object.keys(headers).forEach(key => {
      row[headers[key as keyof typeof headers]] = item[key as keyof LendingRecord] ?? ''
    })
    return row
  })

  // 创建工作簿
  const worksheet = XLSX.utils.json_to_sheet(exportData)
  const workbook = XLSX.utils.book_new()
  XLSX.utils.book_append_sheet(workbook, worksheet, '出借台账')

  // 导出文件
  const excelBuffer = XLSX.write(workbook, { bookType: 'xlsx', type: 'array' })
  const blob = new Blob([excelBuffer], { type: 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet' })
  saveAs(blob, `${filename}_${new Date().toLocaleDateString()}.xlsx`)
}
```

**导出范围**：
- 导出当前筛选条件下的所有数据（不受分页限制）
- 如有勾选行，可选择仅导出勾选的数据

## 7. 组件拆分

```
src/views/ledger/lending/
├── index.vue                    # 页面主文件
└── components/
    ├── SearchForm.vue           # 搜索筛选表单组件
    ├── EditModal.vue            # 编辑弹窗组件（新增/编辑共用）
    └── ActionBar.vue            # 操作按钮栏组件（可选，按钮较少可直接写在index）
```

## 8. 复用说明

| 模块 | 复用情况 | 说明 |
|-----|---------|------|
| 顶部导航栏 | 复用 | 项目已有 |
| 左侧菜单栏 | 复用 | 需添加菜单配置 |
| 标签页区域 | 复用 | 项目已有 |
| 数据表格 | 新开发 | 使用 lay-table 组件 |
| 搜索表单 | 新开发 | 使用 lay-form 组件 |
| 分页组件 | 复用 | 使用 lay-page 组件 |

## 9. 样式规范

### 9.1 颜色使用

- 主题色（按钮等）：`var(--global-primary-color)` (#009688)
- 常规色（编辑按钮）：`var(--global-normal-color)` (#1e9fff)
- 成功色：`var(--global-checked-color)` (#5fb878)
- 危险色（删除按钮）：`var(--global-danger-color)` (#ff5722)

### 9.2 布局规范

- 操作按钮区：右对齐，按钮间距 10px
- 搜索表单：多列布局，一行4个字段
- 表格：带边框、斑马纹
- 分页区：左右分布（数据统计居左，分页器居右）

## 10. 交互细节

### 10.1 表格操作

1. **单选**：点击行勾选复选框
2. **全选**：点击表头复选框全选当前页
3. **排序**：点击列头排序图标切换升序/降序

### 10.2 弹窗编辑操作

1. **新增**：点击"新增"按钮 → 打开空白编辑弹窗 → 填写表单 → 点击"确定"保存
2. **编辑**：勾选一行 → 点击"编辑"按钮 → 打开编辑弹窗（回填数据） → 修改表单 → 点击"确定"保存
3. **取消**：点击"取消"或弹窗外区域 → 关闭弹窗，不保存
4. **弹窗按钮**：底部按钮靠右排列，顺序为 [取消] [确定]

### 10.3 删除操作

1. **删除流程**：勾选数据 → 点击"删除"按钮 → 弹出确认框 → 确认后实际删除列表数据
2. **批量删除**：支持勾选多条数据批量删除
3. **数据更新**：删除成功后刷新列表，更新分页信息

### 10.4 按钮状态

- **新增按钮**：始终可用
- **编辑按钮**：未选中或多选时禁用，单选时可用
- **删除按钮**：未选中数据时禁用
- **导出按钮**：始终可用

### 10.5 提示信息

- 编辑多选时："只能选择一条数据进行编辑"
- 删除前：确认弹窗"确定要删除选中的X条数据吗？"
- 删除成功："删除成功"
- 保存成功："保存成功"
- 导出成功："导出成功，请查看下载文件"

## 11. 开发清单

- [x] 添加菜单配置（数据台账 > 出借台账）
- [x] 添加路由配置
- [x] 安装导出依赖（xlsx、file-saver）
- [x] 创建Mock数据和接口
- [x] 创建API模块
- [x] 开发页面主文件 index.vue
- [x] 开发搜索表单组件 SearchForm.vue
- [x] 开发编辑弹窗组件 EditModal.vue
- [x] 实现表格展示和分页
- [x] 实现搜索筛选功能
- [x] 实现新增功能（弹窗）
- [x] 实现编辑功能（弹窗）
- [x] 实现批量删除功能（实际删除列表数据）
- [x] 实现导出Excel功能（前端生成xlsx文件）
- [x] 样式调整和优化
